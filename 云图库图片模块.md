
ğŸ’¡ è®°å¾—â¡æ‰§è¡Œä¸€ä¸‹ openapi å‘½ä»¤ç”Ÿæˆæ¥å£å¯¹åº”çš„è¯·æ±‚ä»£ç ï¼Œæ¯æ¬¡åç«¯æ”¹åŠ¨æ—¶éƒ½éœ€â è¦è¿™ä¹ˆåšã€‚

### å›¾ç‰‡ä¸Šä¼ å’Œåˆ›å»ºé¡µé¢

#### 1ã€æ–°å»ºè·¯ç”±å’Œèœå•

é¦–å…ˆæ–°å»º `AddPicturePage.vue` é¡µé¢æ–‡ä»¶ï¼Œåœ¨ `router/index.ts` ä¸­å®šä¹‰è·¯ç”±ï¼š

```css
{  
  path: '/add_picture',  
  name: 'åˆ›å»ºå›¾ç‰‡',  
  component: AddPicturePage,  
},
```

åœ¨ GlobalHeader ç»„ä»¶ä¸­è¡¥å……èœå•ï¼š94C1WoRxTBfUrMr2xXkY0xdgwCQqL/cxdjW5pRDl9mk=

```css
{  
  key: '/add_picture',  
  label: 'åˆ›å»ºå›¾ç‰‡',  
  title: 'åˆ›å»ºå›¾ç‰‡',  
}
```

#### 2ã€å›¾ç‰‡ä¸Šä¼ ç»„ä»¶

åœ¨å¼€å‘é¡µé¢å‰â¡ï¼Œå…ˆå¼€å‘é€šç”¨å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ PictureUploadï¼ˆæ”¾åˆ° components ç›®å½•ä¸‹ï¼‰ï¼Œæ”¯æŒâ ä¸Šä¼ å›¾ç‰‡å¹¶è¿”å›å›¾ç‰‡ä¿¡æ¯ã€‚3jr9XBSq3lGU0IMAr/GFkzuP6JLxAOW2gUJ3qQ6bUJw=

1ï¼‰ä½¿ç”¨ Ant Design Vue æä¾›çš„ [upload ç»„ä»¶](https://antdv.com/components/upload-cn#components-upload-demo-avatar) å¿«é€Ÿå¼€å‘ï¼Œå¼•å…¥ç¤ºä¾‹ä»£ç åå°±èƒ½ç«‹åˆ»æµ‹è¯•æ•ˆæœäº†ï¼š

![](![image](https://pic.code-nav.cn/course_picture/1608440217629360130/XO3GifDhRNseeTAI.png)

2ï¼‰è¯¥ç»„ä»¶â¡ä¸ºå—æ§ç»„ä»¶ï¼Œç”±çˆ¶ç»„ä»¶ï¼ˆå›¾ç‰‡åˆ›å»ºé¡µé¢ï¼‰æ¥ç®¡ç†ï¼Œéœ€è¦å®šä¹‰å±æ€§ï¼š3jr9XBSq3lGU0IMAr/GFkzuP6JLxAOW2gUJ3qQ6bUJw=

```typescript
interface Props {  
  picture?: API.PictureVO  
  onSuccess?: (newPicture: API.PictureVO) => void  
}  
  
const props = defineProps<Props>()
```

å…¶ä¸­ï¼Œpictâ¡ure å°±æ˜¯å·²ä¸Šä¼ çš„å›¾ç‰‡ä¿¡æ¯ï¼Œä¼šå±•ç¤ºå‡ºæ¥ï¼›onSuccess æ˜¯ä¸Šä¼ æˆåŠŸåï¼Œéœ€è¦å°†å¾—åˆ°çš„æ–°å›¾ç‰‡ä¿¡æ¯è¿”å›ç»™çˆ¶ç»„ä»¶ï¼Œâ æ¥æ›´æ–° picture çš„å€¼ã€‚

çˆ¶ç»„ä»¶å¯ä»¥è¿™æ ·ä½¿ç”¨ç»„ä»¶ï¼šH/6GyngYeGwcKSSYxe7cjLRhbQ7hrQI18D0g8NjnshU=

```ruby
<PictureUpload :picture="picture" :onSuccess="onSuccess" />
```

```csharp
const picture = ref<API.PictureVO>()  
const onSuccess = (newPicture: API.PictureVO) => {  
  picture.value = newPicture  
}
```

3ï¼‰ä¿®æ”¹é¡µé¢ç»“æ„ä»£ç ï¼Œæ›´æ”¹å±•ç¤ºçš„å›¾ç‰‡åœ°å€ã€æ–‡æ¡ˆç­‰ï¼šB5zDxI1r9BIvt1ldV7oDPnV3j9q2dBLVLH2RJGlpju4=

```php-template
<div class="picture-upload">  
  <a-upload  
    list-type="picture-card"  
    :show-upload-list="false"  
    :custom-request="handleUpload"  
    :before-upload="beforeUpload"  
  >  
    <img v-if="picture?.url" :src="picture?.url" alt="avatar" />  
    <div v-else>  
      <loading-outlined v-if="loading"></loading-outlined>  
      <plus-outlined v-else></plus-outlined>  
      <div class="ant-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡</div>  
    </div>  
  </a-upload>  
</div>
```

4ï¼‰Uplâ¡oad ç»„ä»¶æ”¯æŒä¸Šä¼ å‰æ ¡éªŒå’Œè‡ªå®šä¹‰è¯·æ±‚å¤„ç†é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™å¯¹åº”çš„å‡½æ•°å¹¶ä¼ â é€’ç»™ç»„ä»¶ã€‚

ä¸Šä¼ å‰æ ¡éªŒå‡½æ•°ï¼šwcD3oXMXPL0sPBfCCSqD80J4c7wN43B/9PHkr4Ktj2M=

```csharp
const beforeUpload = (file: UploadProps['fileList'][number]) => {  
  const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png'  
  if (!isJpgOrPng) {  
    message.error('ä¸æ”¯æŒä¸Šä¼ è¯¥æ ¼å¼çš„å›¾ç‰‡ï¼Œæ¨è jpg æˆ– png')  
  }  
  const isLt2M = file.size / 1024 / 1024 < 2  
  if (!isLt2M) {  
    message.error('ä¸èƒ½ä¸Šä¼ è¶…è¿‡ 2M çš„å›¾ç‰‡')  
  }  
  return isJpgOrPng && isLt2M  
}
```

ä¸Šä¼ å›¾ç‰‡è‡³åç«¯çš„å‡½æ•°ï¼š

```csharp
const loading = ref<boolean>(false)  
  
/**  
 * ä¸Šä¼   
 * @param file  
 */  
const handleUpload = async ({ file }: any) => {  
  loading.value = true  
  try {  
    const params = props.picture ? { id: props.picture.id } : {};  
    const res = await uploadPictureUsingPost(params, {}, file)  
    if (res.data.code === 0 && res.data.data) {  
      message.success('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ')  
      // å°†ä¸Šä¼ æˆåŠŸçš„å›¾ç‰‡ä¿¡æ¯ä¼ é€’ç»™çˆ¶ç»„ä»¶  
      props.onSuccess?.(res.data.data)  
    } else {  
      message.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œ' + res.data.message)  
    }  
  } catch (error) {  
    message.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥')  
  } finally {  
    loading.value = false  
  }  
}
```

æ³¨æ„ï¼Œè°ƒç”¨åç«¯â¡ä¸Šä¼ å›¾ç‰‡æ¥å£æ—¶ï¼Œå¦‚æœå·²ç»æœ‰ pictureIdï¼Œè¡¨ç¤ºå¯¹å·²ä¸Šä¼ çš„å›¾ç‰‡è¿›è¡Œæ›´æ–°ï¼Œéœ€è¦å°†è¯¥å‚æ•°ä¹Ÿæ·»åŠ åˆ°è¯·æ±‚ä¸­ï¼Œâ å¦åˆ™æ¯æ¬¡éƒ½ä¼šæ–°å¢å›¾ç‰‡è®°å½•ã€‚

```csharp
const params = props.picture ? { id: props.picture.id } : {};
```

5ï¼‰æœ€åï¼Œâ¡å¯ä»¥å†æŒ‰éœ€ä¼˜åŒ–ä¸‹ç»„ä»¶çš„ CSS æ ·å¼ï¼Œæ¯”å¦‚è®©ç»„ä»¶çš„å®½é«˜ç­‰åŒäºçˆ¶ç»„ä»¶çš„å®½é«˜â ï¼šZKmj9dxNUcNTQdEvTlqg6vC0e24jNy4SbX0b1ykGNiY=

```css
.picture-upload :deep(.ant-upload) {  
  width: 100% !important;  
  height: 100% !important;  
  min-height: 152px;  
  min-width: 152px;  
}  
  
.picture-upload img {  
  max-width: 100%;  
  max-height: 480px;  
}  
  
.ant-upload-select-picture-card i {  
  font-size: 32px;  
  color: #999;  
}  
  
.ant-upload-select-picture-card .ant-upload-text {  
  margin-top: 8px;  
  color: #666;  
}
```

æ³¨æ„ä¸Šè¿°ä»£ç ä¸­ï¼Œéœ€è¦ä½¿ç”¨ `:deep` è¯­æ³•æ¥ä¿®æ”¹ Upload ç»„ä»¶å†…ç½®çš„æ ·å¼ã€‚

æœ€ç»ˆï¼Œç»„ä»¶çš„æ•ˆæœå¦‚å›¾ï¼šxk6SzD99vq/4FGtfew7I+1vr1c0+3Jbxfh2tbjQI3q8=

![](![image](https://pic.code-nav.cn/course_picture/1608440217629360130/2TeabiS0wJuheJoI.webp)

#### 3ã€å¼€å‘åˆ›å»ºé¡µé¢

1ï¼‰å…ˆå¼€å‘â¡é¡µé¢ç»“æ„ï¼Œä»ä¸Šåˆ°ä¸‹åˆ†åˆ«æ˜¯é¡µé¢æ ‡é¢˜ã€å›¾ç‰‡ä¸Šä¼ ç»„ä»¶å’Œè¡¨å•ã€‚è¡¨å•æ”¯æŒå¡«å†™åç§°ã€â ç®€ä»‹ã€åˆ†ç±»å’Œæ ‡ç­¾ï¼š3jr9XBSq3lGU0IMAr/GFkzuP6JLxAOW2gUJ3qQ6bUJw=

```php-template
<div id="addPicturePage">  
  <h2 style="margin-bottom: 16px">åˆ›å»ºå›¾ç‰‡</h2>  
  <PictureUpload :picture="picture" :onSuccess="onSuccess" />  
  <a-form layout="vertical" :model="pictureForm" @finish="handleSubmit">  
    <a-form-item label="åç§°" name="name">  
      <a-input v-model:value="pictureForm.name" placeholder="è¯·è¾“å…¥åç§°" />  
    </a-form-item>  
    <a-form-item label="ç®€ä»‹" name="introduction">  
      <a-textarea  
        v-model:value="pictureForm.introduction"  
        placeholder="è¯·è¾“å…¥ç®€ä»‹"  
        :rows="2"  
        autoSize  
        allowClear  
      />  
    </a-form-item>  
    <a-form-item label="åˆ†ç±»" name="category">  
      <a-auto-complete  
        v-model:value="pictureForm.category"  
        placeholder="è¯·è¾“å…¥åˆ†ç±»"  
        allowClear  
      />  
    </a-form-item>  
    <a-form-item label="æ ‡ç­¾" name="tags">  
      <a-select  
        v-model:value="pictureForm.tags"  
        mode="tags"  
        placeholder="è¯·è¾“å…¥æ ‡ç­¾"  
        allowClear  
      />  
    </a-form-item>  
    <a-form-item>  
      <a-button type="primary" html-type="submit" style="width: 100%">åˆ›å»º</a-button>  
    </a-form-item>  
  </a-form>  
</div>
```

æ³¨æ„ï¼Œæˆ‘ä»¬é’ˆå¯¹ä¸åŒçš„æ•°æ®ä½¿ç”¨äº†ä¸åŒçš„è¾“å…¥ç»„ä»¶ï¼š

-   åç§°ï¼š[æ™®é€šè¾“å…¥æ¡†](https://antdv.com/components/input-cn#components-input-demo-basic)
    
-   ç®€ä»‹ï¼š[TextArea å¤šè¡Œè¾“å…¥æ¡†](https://antdv.com/components/input-cn#components-input-demo-autosize-textarea)
    
-   åˆ†ç±»ï¼š[AutoComplete è¾“å…¥æ¡†](https://antdv.com/components/auto-complete-cn)ï¼Œå¯ä»¥è‡ªç”±è¾“å…¥ï¼ŒåŒæ—¶ä¼šç»™å‡ºæœç´¢æç¤º
    
-   æ ‡ç­¾ï¼š[Select é€‰æ‹©æ¡†](https://antdv.com/components/select-cn#components-select-demo-tags)ï¼Œä½¿ç”¨ mode="tags" æ”¯æŒè‡ªç”±è¾“å…¥å’Œå¤šé€‰
    

å®šä¹‰å˜é‡ï¼Œæ¥å—ä¸Šä¼ çš„å›¾ç‰‡å’Œå¡«å†™çš„è¡¨å•ä¿¡æ¯ï¼š

```csharp
const picture = ref<API.PictureVO>()  
const pictureForm = reactive<API.PictureEditRequest>({})
```

å¯ä»¥é™åˆ¶ä¸‹é¡µé¢æœ€å¤§å®½åº¦ï¼Œè®©ç”¨æˆ·è§†è§’æ›´é›†ä¸­ï¼šB5zDxI1r9BIvt1ldV7oDPnV3j9q2dBLVLH2RJGlpju4=

```css
#addPicturePage {  
  max-width: 720px;  
  margin: 0 auto;  
}
```

æ•ˆæœå¦‚å›¾ï¼š

![](![image](https://pic.code-nav.cn/course_picture/1608440217629360130/JZfblP7uRazOLBoF.webp)

2ï¼‰ä¸Šä¼ å›¾ç‰‡â¡åï¼Œå¯ä»¥å°†å¾—åˆ°çš„å›¾ç‰‡ä¿¡æ¯ï¼ˆæ¯”å¦‚åç§°ï¼‰å¡«å……åˆ°è¡¨å•ï¼Œç›´æ¥èµ‹å€¼å³å¯ï¼šâ€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‰â€‚â â€‰â€‚â€‰â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‰â€‚â€‚â€‰â€‚

```javascript
const onSuccess = (newPicture: API.PictureVO) => {  
  picture.value = newPicture  
  pictureForm.name = newPicture.name  
}
```

3ï¼‰ç¼–å†™æäº¤è¡¨å•çš„å‡½æ•°ï¼Œéœ€è¦å¸¦ç€ä¸Šä¼ å›¾ç‰‡å¾—åˆ°çš„ pictureId æ¥è°ƒç”¨åç«¯ **ä¿®æ”¹å›¾ç‰‡æ¥å£**ï¼ˆè€Œä¸æ˜¯ä¸Šä¼ æ¥å£ï¼‰ï¼š94C1WoRxTBfUrMr2xXkY0xdgwCQqL/cxdjW5pRDl9mk=

```typescript
const router = useRouter()  
  
/**  
 * æäº¤è¡¨å•  
 * @param values  
 */  
const handleSubmit = async (values: any) => {  
  const pictureId = picture.value.id  
  if (!pictureId) {  
    return  
  }  
  const res = await editPictureUsingPost({  
    id: pictureId,  
    ...values,  
  })  
  if (res.data.code === 0 && res.data.data) {  
    message.success('åˆ›å»ºæˆåŠŸ')  
    // è·³è½¬åˆ°å›¾ç‰‡è¯¦æƒ…é¡µ  
    router.push({  
      path: `/picture/${pictureId}`,  
    })  
  } else {  
    message.error('åˆ›å»ºå¤±è´¥ï¼Œ' + res.data.message)  
  }  
}
```

åˆ›å»ºæˆåŠŸåï¼Œéœ€è¦è·³è½¬åˆ°å›¾ç‰‡è¯¦æƒ…é¡µã€‚

4ï¼‰ç»™åˆ†ç±»â¡å’Œæ ‡ç­¾é€‰æ‹©æ¡†è¡¥å……é€‰é¡¹æ•°æ®ï¼Œæ³¨æ„éœ€è¦è½¬æ¢ä¸ºè¾“å…¥ç»„ä»¶æ¥å—çš„æ ¼å¼ï¼šxk6SzD99vq/4FGtfew7I+1vr1c0+3Jbxfh2tbjQI3q8=

```typescript
const categoryOptions = ref<string[]>([])  
const tagOptions = ref<string[]>([])  
  
// è·å–æ ‡ç­¾å’Œåˆ†ç±»é€‰é¡¹  
const getTagCategoryOptions = async () => {  
  const res = await listPictureTagCategoryUsingGet()  
  if (res.data.code === 0 && res.data.data) {  
    // è½¬æ¢æˆä¸‹æ‹‰é€‰é¡¹ç»„ä»¶æ¥å—çš„æ ¼å¼  
    tagOptions.value = (res.data.data.tagList ?? []).map((data: string) => {  
      return {  
        value: data,  
        label: data,  
      }  
    })  
    categoryOptions.value = (res.data.data.categoryList ?? []).map((data: string) => {  
      return {  
        value: data,  
        label: data,  
      }  
    })  
  } else {  
    message.error('åŠ è½½é€‰é¡¹å¤±è´¥ï¼Œ' + res.data.message)  
  }  
}  
  
onMounted(() => {  
  getTagCategoryOptions()  
})
```

ç»™ç»„ä»¶è¡¥å…… options é€‰é¡¹ï¼š

```php-template
<a-form-item label="åˆ†ç±»" name="category">  
  <a-auto-complete  
    v-model:value="pictureForm.category"  
    :options="categoryOptions"  
    placeholder="è¯·è¾“å…¥åˆ†ç±»"  
    allowClear  
  />  
</a-form-item>  
<a-form-item label="æ ‡ç­¾" name="tags">  
  <a-select  
    v-model:value="pictureForm.tags"  
    :options="tagOptions"  
    mode="tags"  
    placeholder="è¯·è¾“å…¥æ ‡ç­¾"  
    allowClear  
  />  
</a-form-item>
```

æ•ˆæœå¦‚å›¾ï¼š

![](![image](https://pic.code-nav.cn/course_picture/1608440217629360130/1Nri1KHNQHhzvsy5.webp)

5ï¼‰æœ€åï¼Œâ¡å¯ä»¥å†åšä¸€äº›ä¼˜åŒ–ï¼Œæ¯”å¦‚åƒæŸè§†é¢‘ç½‘ç«™æŠ•ç¨¿ä¸€æ ·ï¼Œä¸Šä¼ å›¾ç‰‡åæ‰å±•ç¤ºæ›´å¤šè¡¨å•é¡¹ã€‚f511u+C4wnR0vNwYw5Ep0DnAOEOPd4yUVNgq5aIrOdY=

ç›´æ¥ç”¨ vâ¡-if åˆ¤æ–­å³å¯ï¼Œpicture ä¸ºç©ºåˆ™è¡¨ç¤ºå›¾ç‰‡æœªä¸Šä¼ ï¼š

```php-template
<a-form v-if="picture" layout="vertical" :model="pictureForm"@finish="handleSubmit">  
</a-form>
```

æ•ˆæœå¦‚å›¾ï¼šf511u+C4wnR0vNwYw5Ep0DnAOEOPd4yUVNgq5aIrOdY=

![](![image](https://pic.code-nav.cn/course_picture/1608440217629360130/cVLGntKnMdovFeXu.webp)

### å›¾ç‰‡ä¿¡æ¯ä¿®æ”¹

å¯ä»¥ç›´æ¥å¤ç”¨åˆ›å»ºé¡µé¢ï¼Œåœ¨é¡µé¢åå¢åŠ  URL æŸ¥è¯¢å‚æ•° `?id=xx` è¡¨ç¤ºè¦ä¿®æ”¹å¯¹åº” id çš„å›¾ç‰‡ã€‚wcD3oXMXPL0sPBfCCSqD80J4c7wN43B/9PHkr4Ktj2M=

æ²¡ä¼ è¿™ä¸ªå‚æ•°åˆ™â¡è¡¨ç¤ºåˆ›å»ºæ–°å›¾ç‰‡ï¼Œæœ‰ id çš„è¯å°±ç›´æ¥æ ¹æ® id æŸ¥è¯¢åˆ° picture æ•°æ®ï¼Œå¹¶ä¸”å°†å€¼å¡«å……åˆ°è¡¨å•é¡¹ä¸­ï¼Œå…¶â ä»–çš„é€»è¾‘å’Œåˆ›å»ºå›¾ç‰‡æ˜¯å…¼å®¹çš„ã€‚

1ï¼‰æ ¹æ® â¡id æŸ¥è¯¢è¦ä¿®æ”¹çš„å›¾ç‰‡æ•°æ®ï¼Œå¹¶è®¾ç½®åˆ° picture å˜é‡ä¸­ï¼š

```kotlin
const route = useRoute()  
  
// è·å–è€æ•°æ®  
const getOldPicture = async () => {  
  // è·å–æ•°æ®  
  const id = route.query?.id  
  if (id) {  
    const res = await getPictureVoByIdUsingGet({  
      id: id,  
    })  
    if (res.data.code === 0 && res.data.data) {  
      const data = res.data.data  
      picture.value = data  
      pictureForm.name = data.name  
      pictureForm.introduction = data.introduction  
      pictureForm.category = data.category  
      pictureForm.tags = data.tags  
    }  
  }  
}  
  
onMounted(() => {  
  getOldPicture()  
})
```

2ï¼‰ä¼˜åŒ–é¡µé¢ç»†èŠ‚ï¼Œæ¯”å¦‚è®¾ç½®åˆé€‚çš„æ ‡é¢˜ï¼š

```bash
<h2 style="margin-bottom: 16px">  
  {{ route.query?.id ? 'ä¿®æ”¹å›¾ç‰‡' : 'åˆ›å»ºå›¾ç‰‡' }}  
</h2>
```

æ•ˆæœå¦‚å›¾ï¼šMU9iVc9zyFgfVuApYwyS7vGHRd9Au2MOpS1e0/AVmqs=

![](![image](https://pic.code-nav.cn/course_picture/1608440217629360130/EaZBYLHsC57kXOHK.webp)

### å›¾ç‰‡ç®¡ç†

#### 1ã€æ–°å»ºè·¯ç”±å’Œèœå•

é¦–å…ˆæ–°å»º `admin/PictureManagePage.vue` é¡µé¢æ–‡ä»¶ï¼Œåœ¨ `router/index.ts` ä¸­å®šä¹‰è·¯ç”±ï¼š

```css
{  
  path: '/admin/pictureManage',  
  name: 'å›¾ç‰‡ç®¡ç†',  
  component: PictureManagePage,  
}
```

åœ¨ GlobalHeader ç»„ä»¶ä¸­è¡¥å……èœå•ï¼šH/6GyngYeGwcKSSYxe7cjLRhbQ7hrQI18D0g8NjnshU=

```css
{  
  key: '/admin/pictureManage',  
  label: 'å›¾ç‰‡ç®¡ç†',  
  title: 'å›¾ç‰‡ç®¡ç†',  
}
```

ç”±äºä¹‹å‰å·²ç»â¡ç¼–å†™äº†æƒé™æ ¡éªŒé€»è¾‘ï¼Œåœ°å€ä»¥ /admin å¼€å¤´çš„é¡µé¢éƒ½ä¼šé™åˆ¶ä¸ºä»…ç®¡ç†å‘˜å¯è§å’Œå¯ç”¨ï¼Œæ‰€ä»¥æ— â éœ€å†ç¼–å†™é¢å¤–çš„æƒé™æ ¡éªŒä»£ç ã€‚

#### 2ã€å¼€å‘ç®¡ç†é¡µé¢

è·Ÿç”¨æˆ·ç®¡ç†â¡é¡µé¢ç±»ä¼¼ï¼Œé¡µé¢çš„ä¸Šæ–¹æ˜¯æœç´¢æ ï¼Œä¸‹æ–¹æ˜¯è¡¨æ ¼ï¼Œè¡¨æ ¼éœ€è¦æ”¯æŒåˆ†é¡µã€‚

å¤§å¤šæ•°çš„å†…â¡å®¹å¯ä»¥ç›´æ¥å¤ç”¨ç”¨æˆ·ç®¡ç†é¡µé¢çš„ä»£ç ï¼Œå¯ä»¥å…ˆå¤åˆ¶è¿‡æ¥ï¼Œå†è¿›è¡Œä¿®æ”¹ã€‚

1ï¼‰ç»™è¡¨æ ¼å®šä¹‰å±•ç¤ºçš„åˆ—ï¼šxk6SzD99vq/4FGtfew7I+1vr1c0+3Jbxfh2tbjQI3q8=

```yaml
const columns = [  
  {  
    title: 'id',  
    dataIndex: 'id',  
    width: 80,  
  },  
  {  
    title: 'å›¾ç‰‡',  
    dataIndex: 'url',  
  },  
  {  
    title: 'åç§°',  
    dataIndex: 'name',  
  },  
  {  
    title: 'ç®€ä»‹',  
    dataIndex: 'introduction',  
    ellipsis: true,  
  },  
  {  
    title: 'ç±»å‹',  
    dataIndex: 'category',  
  },  
  {  
    title: 'æ ‡ç­¾',  
    dataIndex: 'tags',  
  },  
  {  
    title: 'å›¾ç‰‡ä¿¡æ¯',  
    dataIndex: 'picInfo',  
  },  
  {  
    title: 'ç”¨æˆ· id',  
    dataIndex: 'userId',  
    width: 80,  
  },  
  {  
    title: 'åˆ›å»ºæ—¶é—´',  
    dataIndex: 'createTime',  
  },  
  {  
    title: 'ç¼–è¾‘æ—¶é—´',  
    dataIndex: 'editTime',  
  },  
  {  
    title: 'æ“ä½œ',  
    key: 'action',  
  },  
]
```

2ï¼‰ä»åç«¯è·å–æ•°æ®ï¼Œå¹¶æ”¯æŒæœç´¢å’Œåˆ†é¡µï¼š

```typescript
// æ•°æ®  
const dataList = ref([])  
const total = ref(0)  
  
// æœç´¢æ¡ä»¶  
const searchParams = reactive<API.PictureQueryRequest>({  
  current: 1,  
  pageSize: 10,  
  sortField: 'createTime',  
  sortOrder: 'descend',  
})  
  
// åˆ†é¡µå‚æ•°  
const pagination = computed(() => {  
  return {  
    current: searchParams.current ?? 1,  
    pageSize: searchParams.pageSize ?? 10,  
    total: total.value,  
    showSizeChanger: true,  
    showTotal: (total) => `å…± ${total} æ¡`,  
  }  
})  
  
// è·å–æ•°æ®  
const fetchData = async () => {  
  const res = await listPictureByPageUsingPost({  
    ...searchParams,  
  })  
  if (res.data.data) {  
    dataList.value = res.data.data.records ?? []  
    total.value = res.data.data.total ?? 0  
  } else {  
    message.error('è·å–æ•°æ®å¤±è´¥ï¼Œ' + res.data.message)  
  }  
}  
  
// é¡µé¢åŠ è½½æ—¶è¯·æ±‚ä¸€æ¬¡  
onMounted(() => {  
  fetchData()  
})  
  
// è·å–æ•°æ®  
const doSearch = () => {  
  // é‡ç½®æœç´¢æ¡ä»¶  
  searchParams.current = 1  
  fetchData()  
}  
  
// è¡¨æ ¼å˜åŒ–å¤„ç†  
const doTableChange = (page: any) => {  
  searchParams.current = page.current  
  searchParams.pageSize = page.pageSize  
  fetchData()  
}
```

æ³¨æ„ï¼š

1.  è·Ÿç”¨æˆ·ç®¡ç†é¡µé¢ä¸åŒçš„æ˜¯ï¼Œé»˜è®¤æŒ‰ç…§åˆ›å»ºæ—¶é—´é™åºå±•ç¤ºå›¾ç‰‡ï¼Œæœ€æ–°çš„å›¾ç‰‡ä¼šè¢«ä¼˜å…ˆçœ‹åˆ°ã€‚
    
2.  è·å–æ•°æ®æ—¶ï¼Œè°ƒç”¨çš„æ˜¯ä»…ç®¡ç†å‘˜å¯ç”¨çš„æŸ¥è¯¢æ¥å£ listPictureByPageUsingPostï¼ˆä¸æ˜¯ç»™ç”¨æˆ·ä½¿ç”¨çš„æŸ¥è¯¢åŒ…è£…ç±»æ¥å£ï¼‰
    

3ï¼‰è‡ªå®šä¹‰â¡åˆ—çš„å±•ç¤ºï¼Œæ¯”å¦‚å›¾ç‰‡ã€æ ‡ç­¾ã€å›¾ç‰‡è§£æä¿¡æ¯ã€åˆ›å»ºæ—¶é—´ã€ç¼–è¾‘æ—¶é—´ç­‰ï¼šMU9iVc9zyFgfVuApYwyS7vGHRd9Au2MOpS1e0/AVmqs=

```php-template
<template #bodyCell="{ column, record }">  
  <template v-if="column.dataIndex === 'url'">  
    <a-image :src="record.url" :width="120" />  
  </template>  
  <!-- æ ‡ç­¾ -->  
  <template v-if="column.dataIndex === 'tags'">  
    <a-space wrap>  
      <a-tag v-for="tag in JSON.parse(record.tags || '[]')" :key="tag">{{ tag }}</a-tag>  
    </a-space>  
  </template>  
  <!-- å›¾ç‰‡ä¿¡æ¯ -->  
  <template v-if="column.dataIndex === 'picInfo'">  
    <div>æ ¼å¼ï¼š{{ record.picFormat }}</div>  
    <div>å®½åº¦ï¼š{{ record.picWidth }}</div>  
    <div>é«˜åº¦ï¼š{{ record.picHeight }}</div>  
    <div>å®½é«˜æ¯”ï¼š{{ record.picScale }}</div>  
    <div>å¤§å°ï¼š{{ (record.picSize / 1024).toFixed(2) }}KB</div>  
  </template>  
  <template v-else-if="column.dataIndex === 'createTime'">  
    {{ dayjs(record.createTime).format('YYYY-MM-DD HH:mm:ss') }}  
  </template>  
  <template v-else-if="column.dataIndex === 'editTime'">  
    {{ dayjs(record.editTime).format('YYYY-MM-DD HH:mm:ss') }}  
  </template>  
  <template v-else-if="column.key === 'action'">  
    <a-button type="link" danger @click="doDelete(record.id)">åˆ é™¤</a-button>  
  </template>  
</template>
```

æ³¨æ„ï¼Œç”±äºåç«¯è¿”å›çš„ tags ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œéœ€è¦ç”¨ `JSON.parse` è½¬ä¸º JS æ•°ç»„ã€‚

4ï¼‰å¼€å‘æœç´¢è¡¨å•ï¼Œæ”¯æŒæŒ‰ç…§å…³é”®è¯ã€ç±»å‹å’Œæ ‡ç­¾æœç´¢ï¼šf511u+C4wnR0vNwYw5Ep0DnAOEOPd4yUVNgq5aIrOdY=

```php-template
<a-form layout="inline" :model="searchParams" @finish="doSearch">  
  <a-form-item label="å…³é”®è¯" name="searchText">  
    <a-input  
      v-model:value="searchParams.searchText"  
      placeholder="ä»åç§°å’Œç®€ä»‹æœç´¢"  
      allow-clear  
    />  
  </a-form-item>  
  <a-form-item label="ç±»å‹" name="category">  
    <a-input v-model:value="searchParams.category" placeholder="è¯·è¾“å…¥ç±»å‹" allow-clear />  
  </a-form-item>  
  <a-form-item label="æ ‡ç­¾" name="tags">  
    <a-select  
      v-model:value="searchParams.tags"  
      mode="tags"  
      placeholder="è¯·è¾“å…¥æ ‡ç­¾"  
      style="min-width: 180px"  
      allow-clear  
    />  
  </a-form-item>  
  <a-form-item>  
    <a-button type="primary" html-type="submit">æœç´¢</a-button>  
  </a-form-item>  
</a-form>
```

5ï¼‰è¡¥å……æ“ä½œæŒ‰é’®ã€‚

å¯ä»¥åœ¨æœç´¢â¡è¡¨å•ä¸Šæ–°å¢ä¸€è¡Œï¼Œå±•ç¤ºæ ‡é¢˜å’Œåˆ›å»ºå›¾ç‰‡æŒ‰é’®ï¼Œç‚¹å‡»æŒ‰é’®ä¼šæ‰“å¼€åˆ›å»ºå›¾ç‰‡é¡µé¢ï¼š3jr9XBSq3lGU0IMAr/GFkzuP6JLxAOW2gUJ3qQ6bUJw=

```php-template
<a-flex justify="space-between">  
  <h2>å›¾ç‰‡ç®¡ç†</h2>  
  <a-button type="primary" href="/add_picture" target="_blank">+ åˆ›å»ºå›¾ç‰‡</a-button>  
</a-flex>
```

åœ¨è¡¨æ ¼æ“ä½œåˆ—ä¸­ï¼Œå¯ä»¥è¡¥å……ç¼–è¾‘æŒ‰é’®ï¼Œç‚¹å‡»åæ‰“å¼€ç¼–è¾‘å›¾ç‰‡é¡µé¢ï¼š

```bash
<a-space>  
  <a-button type="link" :href="`/add_picture?id=${record.id}`" target="_blank">ç¼–è¾‘</a-button>  
  <a-button type="link" danger @click="doDelete(record.id)">åˆ é™¤</a-button>  
</a-space>
```

æœ€ç»ˆé¡µé¢æ•ˆæœå¦‚å›¾ï¼š

![](![image](https://pic.code-nav.cn/course_picture/1608440217629360130/RPKnXlx2tFlP8Qaa.webp)

ğŸ’¡ å¦‚æœè§‰å¾—è¡¨æ ¼çš„åˆ—åœ¨çª„å±ä¸‹ä¼šå—åˆ°æŒ¤å‹ï¼Œå¯ä»¥ç»™ table ç»„ä»¶å¢åŠ å±æ€§ `:scroll="{ x: 'max-content' }"`ï¼Œä½¿è¡¨æ ¼æ”¯æŒæ¨ªå‘æ»šåŠ¨ã€‚3jr9XBSq3lGU0IMAr/GFkzuP6JLxAOW2gUJ3qQ6bUJw=

### å›¾ç‰‡åˆ—è¡¨é¡µï¼ˆä¸»é¡µï¼‰

æ•´ä¸ªé¡µé¢å¸ƒâ¡å±€ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡ä¸ºï¼šæœç´¢æ¡†ã€åˆ†ç±»é€‰é¡¹ã€æ ‡ç­¾é€‰é¡¹ã€å›¾ç‰‡åˆ—è¡¨ã€åˆ†é¡µæ“ä½œæ ã€‚

#### 1ã€åˆ†é¡µåˆ—è¡¨å¼€å‘

1ï¼‰ä½¿ç”¨ [å“åº”å¼çš„ List ç»„ä»¶](https://antdv.com/components/list-cn#components-list-demo-resposive) ï¼Œä¼šæ ¹æ®å±å¹•å¤§å°è°ƒæ•´æ¯è¡Œå±•ç¤ºçš„å›¾ç‰‡æ•°ï¼š

```php-template
<!-- å›¾ç‰‡åˆ—è¡¨ -->  
<a-list  
  :grid="{ gutter: 16, xs: 1, sm: 2, md: 3, lg: 4, xl: 5, xxl: 6 }"  
  :data-source="dataList"  
  :pagination="pagination"  
  :loading="loading"  
>  
  <template #renderItem="{ item: picture }">  
    <a-list-item>  
      <!-- å•å¼ å›¾ç‰‡ -->  
    </a-list-item>  
  </template>  
</a-list>
```

2ï¼‰å®šä¹‰æ•°æ®ã€æœç´¢æ¡ä»¶ã€åˆ†é¡µå‚æ•°ï¼Œä»¥åŠè·å–æ•°æ®çš„å‡½æ•°ï¼šZKmj9dxNUcNTQdEvTlqg6vC0e24jNy4SbX0b1ykGNiY=

```kotlin
// æ•°æ®  
const dataList = ref([])  
const total = ref(0)  
const loading = ref(true)  
  
// æœç´¢æ¡ä»¶  
const searchParams = reactive<API.PictureQueryRequest>({  
  current: 1,  
  pageSize: 12,  
  sortField: 'createTime',  
  sortOrder: 'descend',  
})  
  
// åˆ†é¡µå‚æ•°  
const pagination = computed(() => {  
  return {  
    current: searchParams.current ?? 1,  
    pageSize: searchParams.pageSize ?? 10,  
    total: total.value,  
    // åˆ‡æ¢é¡µå·æ—¶ï¼Œä¼šä¿®æ”¹æœç´¢å‚æ•°å¹¶è·å–æ•°æ®  
    onChange: (page, pageSize) => {  
      searchParams.current = page  
      searchParams.pageSize = pageSize  
      fetchData()  
    },  
  }  
})  
  
// è·å–æ•°æ®  
const fetchData = async () => {  
  loading.value = true  
  const res = await listPictureVoByPageUsingPost(searchParams)  
  if (res.data.data) {  
    dataList.value = res.data.data.records ?? []  
    total.value = res.data.data.total ?? 0  
  } else {  
    message.error('è·å–æ•°æ®å¤±è´¥ï¼Œ' + res.data.message)  
  }  
  loading.value = false  
}  
  
// é¡µé¢åŠ è½½æ—¶è¯·æ±‚ä¸€æ¬¡  
onMounted(() => {  
  fetchData()  
})
```

æ³¨æ„ï¼Œä¸Šè¿°â¡ä»£ç ä¸­ï¼Œé±¼çš®æ•…æ„ç§»é™¤äº†æ•°æ®çš„æ€»æ•°å’Œåˆ‡æ¢æ¯é¡µæ•°é‡çš„é€‰æ‹©å™¨ï¼Œè¿™äº›ä¿¡æ¯æ²¡å¿…è¦å¯¹ç”¨æˆ·å±•ç¤ºâ ï¼Œå¯ä»¥è®©é¡µé¢æ›´ç²¾ç®€ã€‚

3ï¼‰å±•ç¤ºå›¾ç‰‡ï¼Œå¯ä»¥ä½¿ç”¨ [Card ç»„ä»¶](https://antdv.com/components/card-cn#components-card-demo-flexible-content)ï¼šZKmj9dxNUcNTQdEvTlqg6vC0e24jNy4SbX0b1ykGNiY=

```php-template
<a-list-item style="padding: 0">  
  <!-- å•å¼ å›¾ç‰‡ -->  
  <a-card hoverable>  
    <template #cover>  
      <img  
        style="height: 180px; object-fit: cover"  
        :alt="picture.name"  
        :src="picture.url"  
      />  
    </template>  
    <a-card-meta :title="picture.name">  
      <template #description>  
        <a-flex>  
          <a-tag color="green">  
            {{ picture.category ?? 'é»˜è®¤' }}  
          </a-tag>  
          <a-tag v-for="tag in picture.tags" :key="tag">  
            {{ tag }}  
          </a-tag>  
        </a-flex>  
      </template>  
    </a-card-meta>  
  </a-card>  
</a-list-item>
```

æ³¨æ„ï¼Œç”±äºå›¾ç‰‡çš„å®½é«˜éƒ½æ˜¯ä¸åŒçš„ï¼Œä¸ºäº†é˜²æ­¢é¡µé¢ â€œå‚å·®ä¸é½â€ï¼Œç»™æ‰€æœ‰å›¾ç‰‡ç»Ÿä¸€è®¾ç½®ç›¸åŒçš„é«˜åº¦ã€å¹¶ä½¿ç”¨ `object-fit: cover` ä¼˜åŒ–å›¾ç‰‡çš„å±•ç¤ºæ•ˆæœï¼Œä¸ä¼šå—åˆ°æŒ¤å‹ã€‚

æ•ˆæœå¦‚å›¾ï¼šf511u+C4wnR0vNwYw5Ep0DnAOEOPd4yUVNgq5aIrOdY=

![](![image](https://pic.code-nav.cn/course_picture/1608440217629360130/x74az2A5yAGdDM5E.webp)

#### 2ã€æœç´¢èƒ½åŠ›å¼€å‘

1ï¼‰å¼€å‘æœç´¢æ¡†ï¼Œä½¿ç”¨ [Input.Search ç»„ä»¶](https://antdv.com/components/input-cn#components-input-demo-search-input)ï¼Œå…ˆå®šä¹‰é¡µé¢ç»“æ„ï¼šxk6SzD99vq/4FGtfew7I+1vr1c0+3Jbxfh2tbjQI3q8=

```php-template
<!-- æœç´¢æ¡† -->  
<div class="search-bar">  
  <a-input-search  
    placeholder="ä»æµ·é‡å›¾ç‰‡ä¸­æœç´¢"  
    v-model:value="searchParams.searchText"  
    enter-button="æœç´¢"  
    size="large"  
    @search="doSearch"  
  />  
</div>
```

2ï¼‰ç‚¹å‡»æœç´¢æŒ‰é’®æ—¶ï¼Œè§¦å‘æœç´¢äº‹ä»¶ï¼š

```javascript
const doSearch = () => {  
  // é‡ç½®æœç´¢æ¡ä»¶  
  searchParams.current = 1  
  fetchData()  
}
```

3ï¼‰ä¼˜åŒ– CSS æ ·å¼ï¼š

```css
#homePage .search-bar {  
  max-width: 480px;  
  margin: 0 auto 16px;  
}
```

#### 3ã€åˆ†ç±»å’Œæ ‡ç­¾ç­›é€‰èƒ½åŠ›

1ï¼‰å…ˆå¼€å‘é¡µé¢ç»“æ„ã€‚åˆ†ç±»ä»…æ”¯æŒå•é€‰ï¼Œå¯ä»¥ä½¿ç”¨ [Tabs ç»„ä»¶](https://antdv.com/components/tabs-cn#components-tabs-demo-slide)ï¼›æ ‡ç­¾æ”¯æŒå¤šé€‰ï¼Œå¯ä»¥ä½¿ç”¨ [æ ‡ç­¾é€‰æ‹©å™¨ç»„ä»¶](https://antdv.com/components/tag-cn#components-tag-demo-checkable)ã€‚

ä¸ºäº†æ”¯æŒå–â¡æ¶ˆé€‰ä¸­çš„åˆ†ç±»ï¼Œå¯ä»¥æ–°å¢ä¸€ä¸ª â€œå…¨éƒ¨â€ åˆ†ç±»ï¼Œé¡µé¢ä»£ç å¦‚ä¸‹ï¼š

```php-template
<!-- åˆ†ç±» + æ ‡ç­¾ -->  
<a-tabs v-model:activeKey="selectedCategory" @change="doSearch">  
  <a-tab-pane key="all" tab="å…¨éƒ¨" />  
  <a-tab-pane v-for="category in categoryList" :key="category" :tab="category" />  
</a-tabs>  
<div class="tag-bar">  
  <span style="margin-right: 8px">æ ‡ç­¾ï¼š</span>  
  <a-space :size="[0, 8]" wrap>  
    <a-checkable-tag  
      v-for="(tag, index) in tagList"  
      :key="tag"  
      v-model:checked="selectedTagList[index]"  
      @change="doSearch"  
    >  
      {{ tag }}  
    </a-checkable-tag>  
  </a-space>  
</div>
```

2ï¼‰å®šä¹‰å¯â¡é€‰åˆ†ç±» / æ ‡ç­¾åˆ—è¡¨ã€é€‰ä¸­çš„åˆ†ç±» / æ ‡ç­¾ï¼Œå¹¶è·å–åˆ†ç±»å’Œæ ‡ç­¾é€‰é¡¹ï¼š

```csharp
const categoryList = ref<string[]>([])  
const selectedCategory = ref<string>('all')  
const tagList = ref<string[]>([])  
const selectedTagList = ref<string[]>([])  
  
// è·å–æ ‡ç­¾å’Œåˆ†ç±»é€‰é¡¹  
const getTagCategoryOptions = async () => {  
  const res = await listPictureTagCategoryUsingGet()  
  if (res.data.code === 0 && res.data.data) {  
    // è½¬æ¢æˆä¸‹æ‹‰é€‰é¡¹ç»„ä»¶æ¥å—çš„æ ¼å¼  
    categoryList.value = res.data.data.categoryList ?? []  
    tagList.value = res.data.data.tagList ?? []  
  } else {  
    message.error('åŠ è½½åˆ†ç±»æ ‡ç­¾å¤±è´¥ï¼Œ' + res.data.message)  
  }  
}  
  
onMounted(() => {  
  getTagCategoryOptions()  
})
```

3ï¼‰åœ¨æœç´¢æ—¶ï¼Œéœ€è¦å°†é€‰ä¸­çš„åˆ†ç±»å’Œæ ‡ç­¾è½¬æ¢ä¸ºå¯¹åº”çš„è¯·æ±‚å‚æ•°ï¼šf511u+C4wnR0vNwYw5Ep0DnAOEOPd4yUVNgq5aIrOdY=

```kotlin
const fetchData = async () => {  
  loading.value = true  
  // è½¬æ¢æœç´¢å‚æ•°  
  const params = {  
    ...searchParams,  
    tags: [],  
  }  
  if (selectedCategory.value !== 'all') {  
    params.category = selectedCategory.value  
  }  
  selectedTagList.value.forEach((useTag, index) => {  
    if (useTag) {  
      params.tags.push(tagList.value[index])  
    }  
  })  
  const res = await listPictureVoByPageUsingPost(params)  
  if (res.data.data) {  
    dataList.value = res.data.data.records ?? []  
    total.value = res.data.data.total ?? 0  
  } else {  
    message.error('è·å–æ•°æ®å¤±è´¥ï¼Œ' + res.data.message)  
  }  
  loading.value = false  
}
```

4ï¼‰ç»™å›¾ç‰‡å¡ç‰‡ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»å›¾ç‰‡åä¼šè·³è½¬åˆ°å›¾ç‰‡è¯¦æƒ…é¡µã€‚

ä¿®æ”¹é¡µé¢ï¼šH/6GyngYeGwcKSSYxe7cjLRhbQ7hrQI18D0g8NjnshU=

```php-template
<!-- å•å¼ å›¾ç‰‡ -->  
<a-card hoverable @click="doClickPicture(picture)">
```

è¡¥å……è·³è½¬äº‹ä»¶ï¼š

```javascript
const router = useRouter()  
// è·³è½¬è‡³å›¾ç‰‡è¯¦æƒ…  
const doClickPicture = (picture) => {  
  router.push({  
    path: `/picture/${picture.id}`,  
  })  
}
```

æœ€ç»ˆçš„é¡µé¢æ•ˆæœå¦‚å›¾ï¼Œæ˜¯ä¸æ˜¯æœ‰å†…å‘³å„¿äº†ï¼Ÿ

![](![image](https://pic.code-nav.cn/course_picture/1608440217629360130/eCGieuUqUwa4GTWK.webp)

#### 4ã€æ‰©å±•æ€è·¯

1ï¼‰å¦‚æœæƒ³ä¿ç•™â¡å½“å‰ç”¨æˆ·ä¹‹å‰çš„æœç´¢å‚æ•°ï¼Œå¯ä»¥åœ¨ä¿®æ”¹æœç´¢å‚æ•°æ—¶ï¼ŒåŒæ­¥ä¿®æ”¹ URL æŸ¥è¯¢å‚æ•°ï¼›å¹¶ä¸”åœ¨é¡µé¢åˆ·æ–°æ—¶ï¼Œå°† URL â æŸ¥è¯¢å‚æ•°è®¾ç½®åˆ°æœç´¢å‚æ•°ä¸­ã€‚

2ï¼‰ä¼˜åŒ–å›¾ç‰‡åˆ—è¡¨çš„å±•ç¤ºæ•ˆæœâ¡ã€‚å¯ä»¥ç”¨è‡ªé€‚åº”ç€‘å¸ƒæµ + ä¸‹æ‹‰åŠ è½½çš„æ–¹å¼å®ç°ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šçš„æ’ä»¶ã€‚ä½†æ˜¯æ³¨æ„ï¼Œä¸ºäº†é˜²æ­¢ä¸‹æ‹‰åŠ è½½æ—¶è·å¾—é‡å¤çš„æ•°æ®ï¼Œåç«¯æœ€å¥½æ”¹ä¸ºä½¿ç”¨æ¸¸æ ‡æŸ¥è¯¢â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‰â â€‚â€‰â€‚â€‰â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‰â€‚â€‚â€‰â€‚

3ï¼‰ä¼˜åŒ–å›¾â¡ç‰‡æœ¬èº«çš„å±•ç¤ºæ•ˆæœã€‚å¯ä»¥å°†å¡ç‰‡çš„é¢å¤–ä¿¡æ¯æŠ˜å åˆ°å›¾ç‰‡å†…éƒ¨ï¼Œå®ç°æ‚¬æµ®é®ç½©çš„æ•ˆæœï¼Œç”¨ Câ SS å°±èƒ½å®ç°äº†ï¼Œç±»ä¼¼ä¸‹å›¾ï¼šwcD3oXMXPL0sPBfCCSqD80J4c7wN43B/9PHkr4Ktj2M=

![](![image](https://pic.code-nav.cn/course_picture/1608440217629360130/I23XC9qkOi9pkXB5.webp)

### å›¾ç‰‡è¯¦æƒ…é¡µ

#### 1ã€æ–°å»ºè·¯ç”±

é¦–å…ˆæ–°å»º `PictureDetailPage.vue` é¡µé¢æ–‡ä»¶ï¼Œåœ¨ `router/index.ts` ä¸­å®šä¹‰è·¯ç”±ï¼š

```yaml
{  
  path: '/picture/:id',  
  name: 'å›¾ç‰‡è¯¦æƒ…',  
  component: PictureDetailPage,  
  props: true,  
}
```

ç”±äºå›¾ç‰‡è¯¦æƒ…â¡é¡µè¦å±•ç¤ºçš„å›¾ç‰‡æ˜¯æ ¹æ® id è€Œå˜åŒ–çš„ï¼Œæ‰€ä»¥æ­¤å¤„ä½¿ç”¨åŠ¨æ€è·¯ç”±ã€‚åœ¨é¡µé¢ä¸­å¯ä»¥ä½¿ç”¨ propsâ  è·å–åˆ°åŠ¨æ€çš„å‚æ•°ï¼šMU9iVc9zyFgfVuApYwyS7vGHRd9Au2MOpS1e0/AVmqs=

```typescript
const props = defineProps<{  
  id: string | number  
}>()
```

ç„¶åå°±å¯ä»¥åœ¨é¡µé¢åŠ è½½æ—¶ï¼Œé€šè¿‡ id è°ƒç”¨æ¥å£æ¥è·å–åˆ°å›¾ç‰‡ï¼š

```kotlin
const picture = ref<API.PictureVO>({})  
  
// è·å–å›¾ç‰‡è¯¦æƒ…  
const fetchPictureDetail = async () => {  
  try {  
    const res = await getPictureVoByIdUsingGet({  
      id: props.id,  
    })  
    if (res.data.code === 0 && res.data.data) {  
      picture.value = res.data.data  
    } else {  
      message.error('è·å–å›¾ç‰‡è¯¦æƒ…å¤±è´¥ï¼Œ' + res.data.message)  
    }  
  } catch (e: any) {  
    message.error('è·å–å›¾ç‰‡è¯¦æƒ…å¤±è´¥ï¼š' + e.message)  
  }  
}  
  
onMounted(() => {  
  fetchPictureDetail()  
})
```

#### 2ã€é¡µé¢å¼€å‘

1ï¼‰é‡‡ç”¨ä¸€è¡Œä¸¤åˆ—çš„å“åº”å¼å¸ƒå±€ç»“æ„ï¼Œå·¦è¾¹ä½¿ç”¨ [å›¾ç‰‡æµè§ˆç»„ä»¶](https://antdv.com/components/image-cn) å±•ç¤ºå›¾ç‰‡ï¼Œå³è¾¹ä½¿ç”¨ [æè¿°åˆ—è¡¨ç»„ä»¶](https://antdv.com/components/descriptions-cn#components-descriptions-demo-vertical) å±•ç¤ºå›¾ç‰‡ä¿¡æ¯ã€‚

```php-template
<a-row :gutter="[16, 16]">  
  <!-- å›¾ç‰‡å±•ç¤ºåŒº -->  
  <a-col :sm="24" :md="16" :xl="18">  
    <a-card title="å›¾ç‰‡é¢„è§ˆ">  
      <a-image  
        style="max-height: 600px; object-fit: contain"  
        :src="picture.url"  
      />  
    </a-card>  
  </a-col>  
  <!-- å›¾ç‰‡ä¿¡æ¯åŒº -->  
  <a-col :sm="24" :md="8" :xl="6">  
    <a-card title="å›¾ç‰‡ä¿¡æ¯">  
      <a-descriptions :column="1">  
        <a-descriptions-item label="ä½œè€…">  
          <a-space>  
            <a-avatar :size="24" :src="picture.user?.userAvatar" />  
            <div>{{ picture.user?.userName }}</div>  
          </a-space>  
        </a-descriptions-item>  
        <a-descriptions-item label="åç§°">  
          {{ picture.name ?? 'æœªå‘½å' }}  
        </a-descriptions-item>  
        <a-descriptions-item label="ç®€ä»‹">  
          {{ picture.introduction ?? '-' }}  
        </a-descriptions-item>  
        <a-descriptions-item label="åˆ†ç±»">  
          {{ picture.category ?? 'é»˜è®¤' }}  
        </a-descriptions-item>  
        <a-descriptions-item label="æ ‡ç­¾">  
          <a-tag v-for="tag in picture.tags" :key="tag">  
            {{ tag }}  
          </a-tag>  
        </a-descriptions-item>  
        <a-descriptions-item label="æ ¼å¼">  
          {{ picture.picFormat ?? '-' }}  
        </a-descriptions-item>  
        <a-descriptions-item label="å®½åº¦">  
          {{ picture.picWidth ?? '-' }}  
        </a-descriptions-item>  
        <a-descriptions-item label="é«˜åº¦">  
          {{ picture.picHeight ?? '-' }}  
        </a-descriptions-item>  
        <a-descriptions-item label="å®½é«˜æ¯”">  
          {{ picture.picScale ?? '-' }}  
        </a-descriptions-item>  
        <a-descriptions-item label="å¤§å°">  
          {{ formatSize(picture.picSize) }}  
        </a-descriptions-item>  
      </a-descriptions>  
    </a-card>  
  </a-col>  
</a-row>
```

æ³¨æ„ï¼Œä¸ºäº†é˜²æ­¢å›¾ç‰‡è¿‡é«˜ï¼Œç»™å›¾ç‰‡è®¾ç½®æœ€å¤§é«˜åº¦ï¼›å¹¶ä¸”è®¾ç½® `object-fit: contain` è®©å›¾ç‰‡èƒ½å¤Ÿå®Œæ•´å±•ç¤ºã€‚

å¯ä»¥å°†è®¡ç®—å›¾ç‰‡å°ºå¯¸çš„ä»£ç ç§»åŠ¨åˆ° `utils/index.ts` ä¸­ï¼Œä½œä¸ºå·¥å…·ç±»ï¼Œå¯åœ¨å…¶ä»–ä½ç½®å¤ç”¨ï¼š

```kotlin
/**  
 * æ ¼å¼åŒ–æ–‡ä»¶å¤§å°  
 * @param size  
 */  
export const formatSize = (size?: number) => {  
  if (!size) return 'æœªçŸ¥'  
  if (size < 1024) return size + ' B'  
  if (size < 1024 * 1024) return (size / 1024).toFixed(2) + ' KB'  
  return (size / (1024 * 1024)).toFixed(2) + ' MB'  
}
```

2ï¼‰åœ¨æè¿°â¡åˆ—è¡¨ä¸‹è¡¥å……æ“ä½œæŒ‰é’®ï¼Œå¯¹äºå›¾ç‰‡ä¸Šä¼ è€…æˆ–ç®¡ç†å‘˜ï¼Œå¯ä»¥ç¼–è¾‘å’Œåˆ é™¤å›¾ç‰‡ï¼š

```php-template
<a-space wrap>  
  <a-button v-if="canEdit" type="default" @click="doEdit">  
    ç¼–è¾‘  
    <template #icon>  
      <EditOutlined />  
    </template>  
  </a-button>  
  <a-button v-if="canEdit" danger @click="doDelete">  
    åˆ é™¤  
    <template #icon>  
      <DeleteOutlined />  
    </template>  
  </a-button>  
</a-space>
```

ç¼–å†™æƒé™åˆ¤â¡æ–­é€»è¾‘ï¼ŒcanEdit çš„å€¼ä¸º true è¡¨ç¤ºæœ‰ç¼–è¾‘å’Œåˆ é™¤æƒé™ï¼š94C1WoRxTBfUrMr2xXkY0xdgwCQqL/cxdjW5pRDl9mk=

```kotlin
const loginUserStore = useLoginUserStore()  
// æ˜¯å¦å…·æœ‰ç¼–è¾‘æƒé™  
const canEdit = computed(() => {  
  const loginUser = loginUserStore.loginUser;  
  // æœªç™»å½•ä¸å¯ç¼–è¾‘  
  if (!loginUser.id) {  
    return false  
  }  
  // ä»…æœ¬äººæˆ–ç®¡ç†å‘˜å¯ç¼–è¾‘  
  const user = picture.value.user || {}  
  return loginUser.id === user.id || loginUser.userRole === 'admin'  
})
```

ç¼–å†™å¯¹åº”çš„äº‹ä»¶ï¼š

```javascript
// ç¼–è¾‘  
const doEdit = () => {  
  router.push('/add_picture?id=' + picture.value.id)  
}  
// åˆ é™¤  
const doDelete = async () => {  
  const id = picture.value.id  
  if (!id) {  
    return  
  }  
  const res = await deletePictureUsingPost({ id })  
  if (res.data.code === 0) {  
    message.success('åˆ é™¤æˆåŠŸ')  
  } else {  
    message.error('åˆ é™¤å¤±è´¥')  
  }  
}
```

### å›¾ç‰‡ä¸‹è½½

æœ€åï¼Œæˆ‘ä»¬æ¥â¡å¼€å‘å›¾ç‰‡ä¸‹è½½åŠŸèƒ½ã€‚ä¹‹å‰æ–¹æ¡ˆè®¾è®¡ä¸­æåˆ°ï¼Œä¸ºäº†å®ç°æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»å¯¹è±¡å­˜å‚¨çš„ URL ä¸‹â è½½å›¾ç‰‡ï¼Œæ— éœ€ç»è¿‡åç«¯ã€‚

å‰ç«¯å¯ä»¥ä½¿ç”¨ `file-saver` åº“ï¼Œä¸‹è½½æŒ‡å®š URL æˆ–è€…åç«¯è¿”å›çš„ blob å†…å®¹ä¸ºæ–‡ä»¶ã€‚B5zDxI1r9BIvt1ldV7oDPnV3j9q2dBLVLH2RJGlpju4=

1ï¼‰å…ˆå®‰è£… `file-saver` åº“ï¼š

```css
npm install file-saver  
npm i --save-dev @types/file-saver
```

2ï¼‰åœ¨å›¾ç‰‡è¯¦æƒ…é¡µçš„æ“ä½œåŒºåŸŸè¡¥å……ä¸‹è½½æŒ‰é’®ï¼šf511u+C4wnR0vNwYw5Ep0DnAOEOPd4yUVNgq5aIrOdY=

```php-template
<a-button type="primary" @click="doDownload">  
  å…è´¹ä¸‹è½½  
  <template #icon>  
    <DownloadOutlined />  
  </template>  
</a-button>
```

3ï¼‰å®šä¹‰ä¸‹è½½äº‹ä»¶ï¼š

```javascript
// å¤„ç†ä¸‹è½½  
const doDownload = () => {  
  downloadImage(picture.value.url)  
}
```

4ï¼‰åœ¨ `utils/index.ts` ä¸­è¡¥å……ä¸‹è½½å›¾ç‰‡çš„å·¥å…·å‡½æ•°ï¼š

```php
/**  
 * ä¸‹è½½å›¾ç‰‡  
 * @param url å›¾ç‰‡ä¸‹è½½åœ°å€  
 * @param fileName è¦ä¿å­˜ä¸ºçš„æ–‡ä»¶å  
 */  
export function downloadImage(url?: string, fileName?: string) {  
  if (!url) {  
    return  
  }  
  saveAs(url, fileName)  
}
```

æœ€ç»ˆé¡µé¢æ•ˆæœå¦‚å›¾ï¼šxk6SzD99vq/4FGtfew7I+1vr1c0+3Jbxfh2tbjQI3q8=

![](![image](https://pic.code-nav.cn/course_picture/1608440217629360130/iItZMgOx0idfaeQj.webp)

## äº”ã€æ‰©å±•æ€è·¯

1ï¼‰ä½¿ç”¨æ•°â¡æ®åº“è¡¨åŠ¨æ€ç®¡ç†ç½‘ç«™çš„æ ‡ç­¾å’Œåˆ†ç±»ï¼Œå‰ç«¯ä¹Ÿå¯ä»¥æ·»åŠ å¯¹åº”çš„ç®¡ç†ç•Œé¢ï¼Œå³æ ‡ç­¾ç®¡ç†å’Œâ åˆ†ç±»ç®¡ç†ã€‚Xqi3OaKRz+h8DVxZC9HKq+82JY6PWr2H2sd6TLtxY1I=

2ï¼‰å¯ä»¥ä½¿ç”¨å®šâ¡æ—¶ä»»åŠ¡æˆ–è€…æ ‡ç­¾è¡¨å¢åŠ  â€œä½¿ç”¨æ•°â€ å­—æ®µçš„æ–¹å¼ç»Ÿè®¡æ ‡ç­¾çš„ä½¿ç”¨æ¬¡æ•°ï¼Œç»™ä¸»é¡µå±•ç¤ºå‡ºçƒ­é—¨æ ‡ç­¾ï¼Œå¸®åŠ©ç”¨æˆ·æ›´å¿«åœ°æ‰¾åˆ°éœ€â è¦çš„å†…å®¹ã€‚ï¼ˆåˆ†ç±»åŒç†ï¼‰

3ï¼‰å¯ä»¥åœ¨â¡å›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼Œåˆ©ç”¨ AI è‡ªåŠ¨è¡¥å……ç®€ä»‹ã€æ ‡ç­¾å’Œåˆ†ç±»ï¼ˆè¾ƒéš¾ï¼‰ã€‚

3jr9XBSq3lGU0IMAr/GFkzuP6JLxAOW2gUJ3qQ6bUJw=